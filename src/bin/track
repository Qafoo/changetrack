#!/usr/bin/env php
<?php

use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\DependencyInjection\Loader\XmlFileLoader;
use Symfony\Component\DependencyInjection\Loader\YamlFileLoader;
use Symfony\Component\Console\Input\ArgvInput;

require_once __DIR__ . '/../../vendor/autoload.php';

$container = new ContainerBuilder();
$container->setParameter('Qafoo.ChangeTrack.BaseDir', __DIR__ . '/../../');

$loader = new XmlFileLoader(
    $container,
    new FileLocator(
        __DIR__  . '/../config'
    )
);
$loader->load('services.xml');

// Pre-load configuration to allow service injection to depend on it
$input = new ArgvInput();
if ($input->hasParameterOption(array('--config', '-c'))) {
    $configFile = $input->getParameterOption(array('--config', '-c'));

    $loader = new YamlFileLoader(
        $container,
        new FileLocator(
            getcwd()
        )
    );
    $loader->load($configFile);
}

$container->compile();

$application = $container->get('Qafoo.ChangeTrack.Application');

$application->run();
